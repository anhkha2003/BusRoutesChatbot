<!DOCTYPE html>
<html>
  <head>
    <title>Simple Chat Bot</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        height: 100vh;
        background-color: #f5e6ca;
        display: flex;
        justify-content: center; /* Center horizontally */
        align-items: center; /* Center vertically */
        flex-direction: column; /* Added flex direction */
      }

      #chat-container {
        display: flex;
        flex-direction: column;
        align-items: center; /* Center horizontally within the chat container */
        width: 500px; /* Larger width */
        height: 600px; /* Larger height */
        border: 2px solid #9b7653;
        padding: 15px; /* Increased padding */
        background-color: #fff;
        margin-bottom: 15px; /* Increased margin */
        overflow-y: scroll;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }

      #chat-header {
        font-size: 24px; /* Larger font size */
        font-weight: bold;
        margin-bottom: 10px; /* Increased margin */
        background-color: #0056b3; /* Brown background color */
        padding: 10px 20px; /* Increased padding */
        border-radius: 5px; /* Rounded corners */
        color: white; /* White text color */
        position: sticky; /* Keep the header fixed */
        top: 0; /* Position at the top */
        z-index: 1; /* Ensure it appears above the chat messages */
        width: 495px;
        text-align: center;
      }

      #chat-window {
        flex: 1;
        width: 100%;
        font-family: Calibri, sans-serif;
        display: flex; /* Display messages in a column layout */
        flex-direction: column;
      }

      /* Style for the chat bubble */
      .chat-bubble {
        background-color: #007BFF;
        color: white;
        padding: 10px; /* Increased padding */
        border-radius: 10px; /* Increased border radius */
        margin: 10px 0; /* Increased margin */
        max-width: 80%; /* Increased max-width */
        word-wrap: break-word;
        display: flex; /* Added flex for avatar alignment */
        align-items: center;
      }

      /* User messages float to the left */
      .user {
        background-color: #02386e; /* Blue color for user messages */
      }

      /* Bot messages float to the right */
      .bot {
        float: right;
        clear: both;
        background-color: #007BFF; /* Blue color for bot messages */
        align-self: flex-end; /* Align bot messages to the right */
        text-align: right; /* Right-align the text inside bot messages */
      }

      .avatar {
        width: 40px; /* Size of the avatar */
        height: 40px; /* Size of the avatar */
        border-radius: 50%; /* Make it a circle */
        margin-right: 10px; /* Spacing between avatar and message text */
        background-image: url('https://media.istockphoto.com/id/1060696342/vector/robot-icon-chat-bot-sign-for-support-service-concept-chatbot-character-flat-style.jpg?s=612x612&w=0&k=20&c=t9PsSDLowOAhfL1v683JMtWRDdF8w5CFsICqQvEvfzY='); /* Set the default profile picture */
        background-size: cover; /* Make the image cover the circle */
      }

      /* Bot avatar */
      .bot-avatar {
        background-image: url('https://img.freepik.com/premium-vector/account-icon-user-icon-vector-graphics_292645-552.jpg'); /* Replace with the URL of the bot's avatar image */
      }

      #message-input-container {
        display: flex;
        flex-direction: row;
        align-items: center;
        width: 100%;
        padding: 15px; /* Increased padding */
        position: sticky; /* Keep the input container at the bottom */
        bottom: 0; /* Position at the bottom */
        background-color: #fff; /* Match the background color of the chat container */
        z-index: 1; /* Ensure it appears above the chat messages */
      }

      #insert-file-button {
        background-color: #007BFF;
        color: white;
        border: none;
        padding: 10px 15px; /* Adjusted padding */
        border-radius: 5px; /* Increased border radius */
        cursor: pointer;
      }

      #insert-file-button:hover {
        background-color: #0056b3;
      }

      #chat-input {
        flex: 1;
        border: none;
        padding: 10px; /* Increased padding */
        border-radius: 5px; /* Increased border radius */
        margin-right: 10px; /* Increased margin */
        max-width: 100%;
      }

      #send-button {
        background-color: #007BFF;
        color: white;
        border: none;
        padding: 10px 20px; /* Increased padding */
        border-radius: 5px; /* Increased border radius */
        cursor: pointer;
      }

      #send-button:hover {
        background-color: #0056b3;
      }
    </style>
    <script>
      let allMessages = [];

      // Function to scroll to the bottom of the chat container
      function scrollToBottom() {
        var chatContainer = document.getElementById('chat-container');
        chatContainer.scrollTop = chatContainer.scrollHeight;
      }

      function sendMessage() {
        var message = $('#chat-input').val();
        $('#chat-window').append('<div class="chat-bubble user"><div class="avatar"></div>' + message + '</div>');
        $('#chat-input').val('');
        var csrftoken = jQuery("[name=csrfmiddlewaretoken]").val();
        allMessages.push(message);
        $.ajax({
          url: "{% url 'submit' %}",
          type: 'POST',
          headers: { "X-CSRFToken": csrftoken },
          data: {
            messages: allMessages,
          },
          success: function (data) {
            $('#chat-window').append('<div class="chat-bubble bot"><div class="bot-avatar avatar"></div><div style="text-align: right;">' + data.message + '</div></div>');
            allMessages.push(data.message);
            scrollToBottom(); // Call the scroll function after adding a new message
          },
          error: function (error) {
            console.log('Error:', error);
          },
        });
      }

      $(document).ready(function () {
        $('#send-button').on('click', function () {
          sendMessage();
        });
        $('#chat-input').on('keypress', function (e) {
          if (e.which == 13) {
            sendMessage();
          }
        });
      });
    </script>
  </head>
  <body>
    {% csrf_token %}
    <h1 id="chat-header">Restaurant Assistant</h1>
    <div id="chat-container">
      <div id="chat-window"></div>
      <div id="message-input-container">
        <button id="insert-file-button" style="color: white; font-weight: bold;">
            <i class="fas fa-paperclip"></i>
        </button>
        <input id="chat-input" type="text" placeholder="Type a message...">
        <button id="send-button">Send</button>
      </div>
    </div>
  </body>
</html>